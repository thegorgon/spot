-referrer ||= nil        

-if referrer
  %h1.tf
    =referrer.user.first_name.titlecase
    applied to 
    ="#{image_tag "logos/spotblk225x180.png", :size => "55x44"}.".html_safe
    Shouldn't you?

.col.descriptions.left 
  .about
    In order to ensure an unforgettable experience, membership is limited to 
    %strong
      10,000 
    individuals per city. 
    %em
      Apply now 
    to be one of the 
    %strong
      founding members 
    of Spot's select community of restaurant devotees.

  =render :partial => "/site/shared/explanations/pricing"
  =render :partial => "/site/shared/explanations/guarantee"

.col.form.right
  =spot_form_for :application, :url => application_path, :display => "light inlinelabels" do |f|
    =f.fields_for :user_attributes do |uf|
      =uf.name_fields :required => true, :label => "name : ", :value => current_user.try(:names)
      -if logged_in?
        =uf.email_field :email, :placeholder => "email address", :required => true, :label => "email : ", :value => current_user.email
      -else
        =uf.email_field :email, :placeholder => "email address", :required => true, :label => "email : ", "data-validate-url" => availability_email_path, "data-invalid-msg" => "looks like you've already registered"    
        =uf.password_field 'password', :placeholder => "password", :label => "password : "
    -if (city ||= false)
      =f.hidden_field :city_id, @city.try(:id)
    -else
      =f.select 'city_id', City.subscriptions_available.all.collect { |c| [c.name_and_region, c.id] }, {:validity => false, :prompt => "select your city", :selected => current_user.try(:city_id) || @city.try(:id), :label => "city : "}, :required => true
    %hr
    .survey
      =f.fields_for :survey do |sf|
        %li.question=f.label :referred_by, "How did you hear about us?"
        =sf.text_field :referred_by, :placeholder => "referred by", :value => referrer.try(:user).try(:name).try(:titlecase)
        -unless referrer
          %li.note 
            =link_to "referral code?", "#referral_code", :class => "reveals"
        #referral_code{:class => conditionally("hidden", referrer.nil?)}
          %li.question=f.label :referral_code, "Were you given a referral code?"
          =f.text_field :referral_code, :placeholder => "referral code", :value => referrer.try(:token)

        %li.question=f.label :favrestaurant, "What is your favorite restaurant?"
        =sf.text_field :favrestaurant, :placeholder => "demonstrate your refined taste", :required => true
        
    %li.buttons.clearfix
      =button_tag :class => "btnorg300x41 tf" do
        apply now
      
